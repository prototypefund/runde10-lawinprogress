image: python:3.9

cache:
  paths:
    - /.poetry/bin/

variables:
  coverage_report_view: "true"

before_script:
  - test -e $HOME/.poetry/bin/ || curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
  - export PATH="$PATH:$HOME/.poetry/bin/" 
  - source $HOME/.poetry/env 
  - make install
      
stages:
  - lint
  - test

lint-test-job:
  stage: lint
  script:
    - echo "Linting code..."
    - poetry run isort .
    - poetry run black .
    # remove linting for now - poetry run pylint lawinprogress/

unit-test-job:
  stage: test
  script:
    - echo "Running unit tests..."
    - poetry run coverage run -m pytest tests/
    - poetry run coverage report
    - poetry run coverage xml
  artifacts:
    paths:
    - ./coverage.xml
    reports:
      cobertura: coverage.xml